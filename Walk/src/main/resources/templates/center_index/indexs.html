<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>个人中心</title>
    <!-- Google web font "Open Sans" -->
    <link rel="stylesheet" href="http://localhost:8080/MX/center_index/css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="http://localhost:8080/MX/center_index/fontawesome/css/fontawesome-all.min.css">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" type="text/css" href="http://localhost:8080/MX/center_index/slick/slick.css"/>
    <!-- http://kenwheeler.github.io/slick/ -->
    <link rel="stylesheet" type="text/css" href="http://localhost:8080/MX/center_index/slick/slick-theme.css"/>
    <link rel="stylesheet" href="http://localhost:8080/MX/center_index/css/tooplate-style.css">
    <link rel="stylesheet" href="http://localhost:8080/MX/alert/easydialog.css"/>
    <!--
        <script>document.documentElement.className = "js";
        var supportsCssVars = function () {
            var e, t = document.createElement("style");
            return t.innerHTML = "root: { &#45;&#45;tmp-var: bold; }", document.head.appendChild(t), e = !!(window.CSS && window.CSS.supports && window.CSS.supports("font-weight", "var(&#45;&#45;tmp-var)")), t.parentNode.removeChild(t), e
        };
        supportsCssVars() || alert("Please view this in a modern browser such as latest version of Chrome or Microsoft Edge.");
        </script>-->

    <style type="text/css">
        .xg {
            text-align: right;
        }

        .table td {
            border-top: 0;
            vertical-align: middle;
        }

        .dds{
            height: 300px;
            overflow: auto;
        }

        .easyDialog_wrapper .easyDialog_text {
            padding: 25px 10px;
            font-size: 13px;
            line-height: 22px;
            color: red;
        }
    </style>

</head>

<body>
<div id="tm-bg"></div>
<div id="tm-wrap">
    <div class="tm-main-content">
        <div class="container tm-site-header-container" style="background-color: rgba(0,0,0,0.36)">
            <div class="row">
                <div class="col-sm-12 col-md-6 col-lg-6 col-md-col-xl-6 mb-md-0 mb-sm-4 mb-4 tm-site-header-col">
                    <div class="tm-site-header">
                        <h1 class="mb-4">个人中心</h1>
                        <img src="img/underline.png" class="img-fluid mb-4">
                        <p>您可以在此查看订单，也可修改您的基本信息</p>
                        <p>秋天到了，注意保暖呦</p>
                        <p><a style="color: white;" th:href="@{index.html}">返回首页</a></p>
                    </div>
                </div>

                <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                    <div class="content">
                        <div class="grid">

                            <div class="grid__item" id="home-link">
                                <div class="product">
                                    <div class="tm-nav-link">
                                        <i class="fas fa-home fa-3x tm-nav-icon"></i>
                                        <span class="tm-nav-text">基本信息</span>
                                        <div class="product__bg"></div>
                                    </div>
                                    <div class="product__description">

                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <h2 class="tm-page-title" id="xx">个人信息</h2>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6" id="zz">
                                                <table class="table">
                                                    <tbody id="abc">
                                                    <tr>
                                                        <td class="xg">昵称：</td>
                                                        <td>
                                                            <span class="xgy"></span>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="xg">手机号：</td>
                                                        <td>
                                                            <span id="uphones" class="xgy"></span>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="xg">身份证号：</td>
                                                        <td>
                                                            <span class="xgy"></span>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                    <tfoot>
                                                    <tr>
                                                        <td colspan="2" style="text-align: center;">
                                                            <a href="#">修改密码</a>
                                                            <a href="#">编辑资料</a>
                                                        </td>
                                                    </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                            <div class="col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                                <p>注意，修改手机号或身份证都需要验证，请确保是本人操作</p>
                                                <img src="img/welcome-2.jpg" class="img-fluid">
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="grid__item" id="team-link">
                                <div class="product">
                                    <div class="tm-nav-link">
                                        <i class="fas fa-users fa-3x tm-nav-icon"></i>
                                        <span class="tm-nav-text">评论</span>
                                        <div class="product__bg"></div>
                                    </div>
                                    <div class="product__description">
                                        <div class="p-sm-4 p-2">
                                            <div class="row mb-3">
                                                <div class="col-12">
                                                    <h2 class="tm-page-title">评论</h2>
                                                </div>
                                            </div>
                                            <div class="row tm-reverse-sm">
                                                <div class="col-sm-12 col-md-8 col-lg-8 col-xl-8">
                                                    <p class="mb-4">Vestibulum aliquet, arcu accumsan lobortis bibendum,
                                                        justo velit efficitur lorem, at pulvinar mi justo nec lacus.
                                                        Nullam et libero aliquet, luctus nunc sit amet, tincidunt
                                                        ligula. Sed finibus ante sed tortor cursus, nec malesuada lectus
                                                        interdum.</p>
                                                    <p class="mb-4">Sed ex turpis, vulputate in efficitur id, lobortis
                                                        eget nibh. Pellentesque maximus ipsum eget velit imperdiet
                                                        sodales. Suspendisse in blandit mi.</p>
                                                    <p class="mb-5">Pellentesque finibus felis risus, ut malesuada felis
                                                        viverra at. Quisque accumsan in mi non hendrerit.</p>
                                                    <a href="#" class="btn tm-btn-gray">Read More</a>
                                                </div>
                                                <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4 mb-lg-0 mb-sm-4 mb-4">
                                                    <img src="img/team.jpg" class="img-fluid">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid__item">
                                <div class="product">
                                    <div class="tm-nav-link">
                                        <i class="fas fa-handshake fa-3x tm-nav-icon"></i>
                                        <span class="tm-nav-text">我的订单</span>
                                        <div class="product__bg"></div>
                                    </div>
                                    <div class="product__description">

                                        <div class="p-sm-4 p-2">
                                            <div class="row mb-3">
                                                <div class="col-12">
                                                    <h2 class="tm-page-title" id="xy">我的订单</h2>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-12" id="dd">
                                                    <table class="table">
                                                        <tr>
                                                            <td>订单号:<span>1</span></td>
                                                        </tr>
                                                        <tr>
                                                            <td>旅游景点:<span>2</span></td>
                                                        </tr>
                                                        <tr>
                                                            <td>订票时间:<span>3</span></td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <a href="#">查看详情订单</a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-12">
                                                    <!-- <div class="p-sm-4 p-2 tm-img-container">
                                                         <div class="tm-img-slider" id="tmImgSlider">
                                                             <img src="img/gallery-img-01-tn.jpg" alt="Image"
                                                                  class="tm-slider-img">
                                                             <img src="img/gallery-img-02-tn.jpg" alt="Image"
                                                                  class="tm-slider-img">
                                                             <img src="img/gallery-img-03-tn.jpg" alt="Image"
                                                                  class="tm-slider-img">
                                                             <img src="img/gallery-img-04-tn.jpg" alt="Image"
                                                                  class="tm-slider-img">
                                                             <img src="img/gallery-img-05-tn.jpg" alt="Image"
                                                                  class="tm-slider-img">
                                                             <img src="img/gallery-img-06-tn.jpg" alt="Image"
                                                                  class="tm-slider-img">
                                                         </div>
                                                     </div>-->
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="grid__item">
                                <div class="product">
                                    <div class="tm-nav-link">
                                        <i class="fas fa-comments fa-3x tm-nav-icon"></i>
                                        <span class="tm-nav-text">联系我们</span>
                                        <div class="product__bg"></div>
                                    </div>
                                    <div class="product__description">
                                        <div class="pt-sm-4 pb-sm-4 pl-sm-5 pr-sm-5 pt-2 pb-2 pl-3 pr-3">
                                            <div class="row mb-3">
                                                <div class="col-12">
                                                    <h2 class="tm-page-title">建议/反馈</h2>
                                                </div>
                                            </div>
                                            <div class="row mb-4">
                                                <div class="col-12">
                                                    <p>联系客服:</p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-12">
                                                    <form action="index.html" method="post" class="contact-form">
                                                        <div class="row">
                                                            <div class="form-group col-md-6 col-lg-6 col-xl-6">
                                                                <input type="text" id="contact_name" name="contact_name"
                                                                       class="form-control" placeholder="Name"
                                                                       required/>
                                                            </div>
                                                            <div class="form-group col-md-6 col-lg-6 col-xl-6 tm-col-email">
                                                                <input type="email" id="contact_email"
                                                                       name="contact_email" class="form-control"
                                                                       placeholder="Email" required/>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <textarea id="contact_message" name="contact_message"
                                                                      class="form-control" rows="9"
                                                                      placeholder="Message" required></textarea>
                                                        </div>
                                                        <button type="submit" class="btn btn-primary tm-btn-submit">
                                                            Submit
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <p class="small tm-copyright-text">漫行 &copy; 2018 | 解释权由漫行所有</p>
        </footer>
    </div> <!-- .tm-main-content -->
</div>
<!-- load JS -->
<script src="http://localhost:8080/MX/center_index/js/jquery-3.1.1.min.js"></script>
<script src="http://localhost:8080/MX/alert/easydialog.min.js"></script>
<!-- https://jquery.com/ -->
<script th:inline="javascript">
    $(function () {
        $(".tm-main-content").click(function () {
            infos();
            Orders();
        });
    });

    /**
     * 弹框的方法
     */
    function bounced(title){
        easyDialog.open({
            container : {
                content : title
            },
            autoClose : 1000
        });
    }

    /**
     * 点击基本信息
     */
    function infos() {
        $.post("Users", function (us) {
            information(us.u_nickname, us.u_phone, us.u_idcard);
        });
    }

    /**
     * 点击编辑资料
     */
    function bj() {
        $.post("Users", function (us) {
            edit(us.u_nickname, us.u_phone, us.u_idcard);
        })
    }

    /**
     * 点击修改密码
     */
    function changePwd() {
        password();
    }

    /**
     * 点击保存
     */
    function save() {
        //正则表达式(手机号,身份证)
        var phone=/^1[3|4|5|7|8][0-9]{9}$/;
        var idcard=/^[1-9]\d{5}(18|19|2([0-9]))\d{2}(0[0-9]|10|11|12)([0-2][1-9]|30|31)\d{3}[0-9Xx]$/;
        var con=true;
        if($(".details__description #zz :input[name=u_nickname]").val()==""){
            bounced("温馨提示：昵称不能为空！2秒后关闭...");
            $(".details__description #zz :input[name=u_nickname]").focus();
            con=false;
        }else if($(".details__description #zz :input[name=u_phone]").val()==""){
            bounced("温馨提示：手机号不能为空！2秒后关闭...");
            $(".details__description #zz :input[name=u_phone]").focus();
            con=false;
        }else if(phone.test($(".details__description #zz :input[name=u_phone]").val())==false){
            bounced("温馨提示：必须为11位有效手机号码！2秒后关闭...");
            $(".details__description #zz :input[name=u_phone]").val("");
            $(".details__description #zz :input[name=u_phone]").focus();
            con=false;
        }else if($(".details__description #zz :input[name=u_idcard]").val()==""){
            bounced("温馨提示：身份证不能为空！2秒后关闭...");
            $(".details__description #zz :input[name=u_idcard]").focus();
            con=false;
        }else if(idcard.test($(".details__description #zz :input[name=u_idcard]").val())==false){
            bounced("温馨提示：必须为18位有效身份证！2秒后关闭...");
            $(".details__description #zz :input[name=u_idcard]").val("");
            $(".details__description #zz :input[name=u_idcard]").focus();
            con=false;
        }else{
            var from=$("#forms").serialize();
            decodeURIComponent(from,true);//解决中文乱码
            $.post("updateUsers", from, function (ok) {
                if (ok) {
                    information(ok.u_nickname, ok.u_phone, ok.u_idcard);
                    con=true;
                } else {
                    edit(ok.u_nickname, ok.u_phone, ok.u_idcard);
                    con=false;
                }
            })
        }
        return con;

    }

    /**
     * 点击我的订单
     * @constructor
     */
    function Orders() {
        $.post("findByTheorder", function (list) {
            if (list.length > 0) {
                $(".details__close").show();
                $(".details__description #xy").html("");
                $(".details__description #xy").html("我的订单");
                $(".details__description #dd").html("");
                $(".details__description #dd").addClass("dds");

                for (var i = 0; i <list.length ; i++) {
                    var js=list[i];
                    $(".details__description #dd").append("<table class=\"table\">\n" +
                        "                                               <tr>\n" +
                        "                                                  <td>订单号:<span>"+js.o_id+"</span></td>\n" +
                        "                                               </tr>\n" +
                        "                                               <tr>\n" +
                        "                                                  <td>旅游景点:<span>"+js.s_title+"</span></td>\n" +
                        "                                                </tr>\n" +
                        "                                               <tr>\n" +
                        "                                                     <td>订票时间:<span>"+js.o_create+"</span></td>\n" +
                        "                                                </tr>\n" +
                        "                                                    <tr>\n" +
                        "                                                 <td>\n" +
                        "                                                    <a href=\"#\" onclick=\"OrderDetails('"+js.o_id+"')\">查看详情订单</a>\n" +
                        "                                                  </td>\n" +
                        "                                                  </tr>\n" +
                        "                                                    </table>");
                }
            }
        });
    }

    /**
     * 点击查看订单详情
     * @param o_id
     * @constructor
     */
    function OrderDetails(o_id) {
        $.post("findByTheorder?o_id="+o_id, function (list) {
            if (list.length > 0) {
                for (var i = 0; i < list.length; i++) {
                    var js = list[i];
                    Order(o_id,js.m_name,js.s_title,js.o_person,js.tools_id,js.class_id,js.o_price,js.o_create);
                }
            }
        });
    }

    function information(u_nickname, u_phone, u_idcard) {
        $(".details__close").show();
        $(".details__description #zz").html("");
        $(".details__description #xx").html("");
        $(".details__description #xx").html("个人信息");
        $(".details__description #zz").append(
            "                                                    <table class=\"table\">\n" +
            "                                                        <tbody id=\"abc\">\n" +
            "                                                        <tr >\n" +
            "                                                            <td class=\"xg\">昵称：</td>\n" +
            "                                                            <td>\n" +
            "                                                            <span class=\"xgy\">\n" +
            "                                                                " + u_nickname + "\n" +
            "                                                            </span>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td class=\"xg\">手机号：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <span id=\"uphones\" class=\"xgy\">" + u_phone + "</span>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td class=\"xg\">身份证号：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <span class=\"xgy\">" + u_idcard + "</span>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        </tbody>\n" +
            "                                                        <tfoot>\n" +
            "                                                        <tr>\n" +
            "                                                            <td colspan=\"2\" style=\"text-align: center;\" >\n" +
            "                                                                <a href=\"#\" class=\"xgpwd\" onclick=\"changePwd()\">修改密码</a>\n" +
            "                                                                <a href=\"#\" onclick=\"bj()\">编辑资料</a>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        </tfoot>\n" +
            "                                                    </table>" );
    }

    function edit(u_nickname, u_phone, u_idcard) {
        $(".details__close").hide();
        $(".details__description #zz").html("");
        $(".details__description #xx").html("");
        $(".details__description #xx").html("编辑信息");
        $(".details__description #zz").append(
            "                                       <form  id=\"forms\" action=\"#\" method=\"post\">\n" +
            "                                                    <table class=\"table\">\n" +
            "                                                        <tbody id=\"abc\">\n" +
            "                                                        <tr >\n" +
            "                                                            <td class=\"xg\">昵称：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <input  class=\"xgs\"  type=\"text\" name=\"u_nickname\" value=\"" + u_nickname + "\" placeholder=\"请输入昵称\"/>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td class=\"xg\">手机号：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <input class=\"xgs\" type=\"text\" name=\"u_phone\" value=\"" + u_phone + "\" placeholder=\"请输入手机号\"/>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td class=\"xg\">身份证号：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <input class=\"xgs\"  type=\"text\" name=\"u_idcard\" value=\"" + u_idcard + "\" placeholder=\"请输入身份证号\"/>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        </tbody>\n" +
            "                                                        <tfoot>\n" +
            "                                                        <tr>\n" +
            "                                                            <td colspan=\"2\" style=\"text-align: center;\">\n" +
            "                                                                <a href='#' onclick=\"infos()\">返回</a>" +
            "                                                                <a href='#' onclick=\"save()\">保存</a>" +
            "                                                           </td>\n" +
            "                                                        </tr>\n" +
            "                                                        </tfoot>\n" +
            "                                                    </table>\n" +
            "                                          </form>");
    }

    function password() {
        $(".details__close").hide();
        $(".details__description #zz").html("");
        $(".details__description #xx").html("");
        $(".details__description #xx").html("修改密码");
        $(".details__description #zz").append(
            "                                       <form  id=\"formpwd\" action=\"#\" method=\"post\">\n" +
            "                                                    <table class=\"table\">\n" +
            "                                                        <tbody id=\"abc\">\n" +
            "                                                        <tr >\n" +
            "                                                            <td class=\"xg\">验证码：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <input  class=\"xgs\"  type=\"text\" name=\"yzm\" placeholder=\"请输入验证码\"/>\n" +
            "                                                        <span>1121</span>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td class=\"xg\">新密码：</td>\n" +
            "                                                            <td>\n" +
            "                                                                <input class=\"xgs\" type=\"text\" name=\"u_phone\" placeholder=\"请输入新密码\"/>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        </tbody>\n" +
            "                                                        <tfoot>\n" +
            "                                                        <tr>\n" +
            "                                                            <td colspan=\"2\" style=\"text-align: center;\" >\n" +
            "                                                                <a href='#' onclick=\"infos()\">返回</a>" +
            "                                                                <a href='#' onclick=\"#\">保存</a>" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        </tfoot>\n" +
            "                                                    </table>\n"+
            "                                          </form>");
    }

    function Order(o_id,m_name,s_title,o_person,tools_id,class_id,o_price,o_create) {
        var tools_name;
        var prices=Math.round(o_price);
        if(tools_id==0){
            tools_name="汽车";
        }else if(tools_id==1){
            tools_name= "火车";
        }else if(tools_id==2){
            tools_name= "飞机";
        }

        $(".details__close").hide();
        $(".details__description #dd").html("");
        $(".details__description #xy").html("");
        $(".details__description #xy").html("订单详情");
        $(".details__description #dd").removeClass("dds");
        $(".details__description #dd").append(
            "                                                    <table class=\"table\">\n" +
            "                                                        <tr>\n" +
            "                                                            <td><a href=\"#\" onclick=\"Orders()\">返回</a></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>订单号:<span>"+o_id+"</span></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>联系人:<span>"+[[${session.user.u_name}]]+"</span></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>商家:<span>"+m_name+"</span></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>旅游景点:<span>"+s_title+"</span></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>旅客人数:<span>"+o_person+"</span></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>乘坐方式:\n" +
            "                                                                <span>"+tools_name+"</span>\n" +
            "                                                            </td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>乘坐班次:<span>"+class_id+"</span></td>\n" +
            "                                                        </tr>\n" +
            "                                                        <tr>\n" +
            "                                                            <td>价格:" +
            "                                                      <span>￥"+prices+"</span>" +
            "                                                    </td>\n" +
            "                                                        </tr>\n" +
            "                                                      <tr>\n" +
            "                                                         <td>订票时间:" +
            "                                                    <span>"+o_create+"</span>" +
            "                                                 </td>\n" +
            "                                                      </tr>\n" +
            "                                                    </table>");

    }

</script>
<script src="http://localhost:8080/MX/center_index/slick/slick.js"></script>
<!-- http://kenwheeler.github.io/slick/ -->
<script src="http://localhost:8080/MX/center_index/js/anime.min.js"></script>
<!-- http://animejs.com/ -->
<script src="http://localhost:8080/MX/center_index/js/main.js"></script>
<script>

    function setupFooter() {
        var pageHeight = $('.tm-site-header-container').height() + $('footer').height() + 100;

        var main = $('.tm-main-content');

        if ($(window).height() < pageHeight) {
            main.addClass('tm-footer-relative');
        }
        else {
            main.removeClass('tm-footer-relative');
        }
    }

    /* DOM is ready
    ------------------------------------------------*/
    $(function () {

        setupFooter();

        $(window).resize(function () {
            setupFooter();
        });

        $('.tm-current-year').text(new Date().getFullYear());  // Update year in copyright

    });
</script>


</body>
</html>